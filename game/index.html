<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="Tank Chi·∫øn Online - M·ªôt tr√≤ ch∆°i tank chi·∫øn tr·ª±c tuy·∫øn v·ªõi nhi·ªÅu ng∆∞·ªùi ch∆°i c√πng nhau." />
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192"  href="/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="manifest.json" />

    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/ms-icon-144x144.png">
    <meta name="theme-color" content="#ffffff">

    <title>Tank Chi·∫øn Online - tankzoo.io.vn</title>
    <style type="text/css">
        @import url('/assets/css/home.css');
    </style>
  </head>
  <body>
    <div id="game-container"></div>
    
    <div id="leaderboard">
        <ul id="leaderboardList"></ul>
    </div>

    <div id="alert-box">
        <p>‚ö†Ô∏è H√£y xoay ngang ƒëi·ªán tho·∫°i ƒë·ªÉ c√≥ tr·∫£i nghi·ªám game t·ªët nh·∫•t!</p>
        <span class="close-btn" onclick="document.getElementById('alert-box').style.display='none'">&times;</span>
    </div>

    <div id="loginOverlay">
        <div id="loginBox">
            <img src="/logo.png" alt="Tank Chi·∫øn Online" style="max-width: 100%; height: auto; margin-bottom: 10px;">
            <div style="display: flex; gap: 10px; margin: 15px 0;">
                <input type="text" id="playerNameInput" placeholder="Nh·∫≠p t√™n c·ªßa b·∫°n" maxlength="15" autofocus style="flex: 1; margin: 0;">
                <button id="randomNameBtn" style="width: 40px; padding: 0; cursor: pointer; background: #17a2b8; border: none; color: white; border-radius: 5px; font-size: 20px;" title="T√™n ng·∫´u nhi√™n">üé≤</button>
            </div>
            <div style="display: flex; gap: 10px; width: 100%;">
                <button id="installBtn" style="flex: 1;">
                  üì≤ C√†i ƒë·∫∑t game
                </button>
                <button id="startButton" style="flex: 1;">
                  ‚ñ∂Ô∏è V√†o Tr·∫≠n
                </button>
            </div>
        </div>
    </div>

    <div id="respawnOverlay">
        <div>B·∫†N ƒê√É B·ªä TI√äU DI·ªÜT!</div>
        <div>H·ªìi sinh trong:</div>
        <div id="respawnCount">3</div>
    </div>

    <script type="module" src="/src/main.js"></script>
    <script>
      let deferredPrompt;
      const installBtn = document.getElementById('installBtn');

      window.addEventListener('beforeinstallprompt', (e) => {
        e.preventDefault();
        deferredPrompt = e;
        installBtn.style.display = 'block';
        console.log('beforeinstallprompt fired');
      });

      installBtn.addEventListener('click', async () => {
        // Check environment
        const isChrome = /Chrome/.test(navigator.userAgent) && /Google Inc/.test(navigator.vendor);
        const isAndroid = /Android/.test(navigator.userAgent);

        if (!deferredPrompt) {
          if (!isChrome) {
             if (isAndroid) {
                 // Try to open in Chrome on Android
                 const url = window.location.href.replace(/^https?:\/\//, '');
                 window.location.href = `intent://${url}#Intent;scheme=https;package=com.android.chrome;end`;
             } else {
                 alert("Vui l√≤ng s·ª≠ d·ª•ng tr√¨nh duy·ªát Google Chrome ƒë·ªÉ c√≥ tr·∫£i nghi·ªám t·ªët nh·∫•t v√† c√†i ƒë·∫∑t game!");
             }
          }
          return;
        }
        
        if (deferredPrompt) {
          deferredPrompt.prompt();
          const { outcome } = await deferredPrompt.userChoice;
          console.log(`User response to the install prompt: ${outcome}`);
          deferredPrompt = null;
          installBtn.style.display = 'none';
        }
      });

      window.addEventListener('appinstalled', () => {
        installBtn.style.display = 'none';
        deferredPrompt = null;
        console.log('PWA was installed');
      });

      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('/sw.js').then(registration => {
            console.log('ServiceWorker registration successful with scope: ', registration.scope);
          }, err => {
            console.log('ServiceWorker registration failed: ', err);
          });
        });
      }
    </script>
  </body>
</html>
